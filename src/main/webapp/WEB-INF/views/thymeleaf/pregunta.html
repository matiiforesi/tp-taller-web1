<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pregunta</title>
    <!-- Boostrap core css -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}"/>

    <!-- custom style -->
    <link rel="stylesheet" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" th:href="@{/css/pregunta.css}">
</head>
<body>

<div class="contenedor_general w-100">

    <div id="tiempoAgotadoCard" style="display: none;">
        <div class="card" style="max-width: 400px; margin: 20px auto; padding: 20px; border: 2px solid red; background-color: #ffe6e6;">
            <h3>⏰ Tiempo agotado</h3>
            <p>Puntaje total: <span th:text="${puntajeTotal}"></span></p>
            <a th:href="@{/home}" class="btn btn-primary">Volver al home</a>
        </div>
    </div>
    <div id="contenedor-pregunta">
        <div>Tiempo restante: <span id="timer" th:text="${tiempoRestante}"></span> segundos</div>
<h2 th:text="${pregunta.enunciado}"></h2>
        <form th:if="${!respondida}" th:action="@{'/juego/' + ${cuestionario.id} + '/validar'}" method="post">
            <input type="hidden" name="idPregunta" th:value="${pregunta.id}" />

            <div class="d-grid gap-3">
                <button type="submit" name="respuesta" th:value="${opcion}"
                        th:each="opcion : ${opciones}"
                        class="btn btn-outline-primary btn-lg">
                    <span th:text="${opcion}"></span>
                </button>
            </div>
        </form>
   <!--
<form id="formulario" th:if="${!respondida}" th:action="@{'/juego/' + ${cuestionario.id} + '/validar'}" method="post">
    <div th:each="opcion : ${opciones}">
        <label>
            <input type="radio" name="respuesta" th:value="${opcion}" required>
            <span th:text="${opcion}"></span>
        </label><br/>
    </div>
    <input type="hidden" name="idPregunta" th:value="${pregunta.id}" />
    <input type="hidden" name="indicePregunta" th:value="${indicePregunta}">
    <input class="btn btn-success" type="submit" value="Responder">
</form>-->

        <div th:if="${respondida}">
            <div th:if="${esCorrecta}" style="color: green; font-weight: bold;">
                ✅ ¡Respuesta correcta!
                <p>Puntaje Total <span th:text="${puntajeTotal}"></span></p>
                <form th:action="@{/siguiente}" method="post">
                    <!--<input type="hidden" name="indicePregunta" th:value="${indicePregunta}">-->
                    <button type="submit" class="btn btn-primary">Siguiente</button>
                </form>
            </div>
            <div th:if="${!esCorrecta}" style="color: red; font-weight: bold;">
                ❌ Respuesta incorrecta.
                <p>Puntaje Total <span th:text="${puntajeTotal}"></span></p>
                <form th:action="@{/siguiente}" method="post">
                    <!--<input type="hidden" name="indicePregunta" th:value="${indicePregunta}">-->
                    <button type="submit" class="btn btn-primary">Siguiente</button>
                </form>
               <!-- <a th:href="@{/home}" class="btn btn-primary">Volver al home</a> -->
            </div>


        </div>
</div>
</div>

<script th:inline="javascript">
    let tiempo = [[${tiempoRestante}]];
    const timerSpan = document.getElementById("timer");
    let respondida=[[${respondida}]];
    let card= document.getElementById("tiempoAgotadoCard");
    let form=document.getElementById("contenedor-pregunta");
    const interval = setInterval(() => {

    if(respondida){
         clearInterval(interval);
           return}
      tiempo--;
      timerSpan.textContent = tiempo;

      if (tiempo <= 0) {
        clearInterval(interval);
        card.style.display="block";
        form.style.display="none";
      }
    }, 1000);
</script>
</body>
</html>